!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.WebStorageCache=t()}(this,function(){"use strict";function e(e,t){for(var r in t)e[r]=t[r];return e}function t(e){var t=!1;if(e&&e.setItem){t=!0;var r="__"+Math.round(1e7*Math.random());try{e.setItem(r,r),e.removeItem(r)}catch(n){t=!1}}return t}function r(e){var t=typeof e;return"string"===t?window[e]:e}function n(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function i(e,t){if(t=t||new Date,"number"==typeof e?e=1/0===e?u:new Date(t.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!n(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e}function a(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}function o(e,t,r,n){if(console.warn("Quota exceeded!"),r&&r.force===!0){var i=this.deleteAllExpires();console.warn("delete all expires CacheItem : ["+i+"] and try execute `set` method again!");try{r.force=!1,this.set(e,t,r)}catch(n){console.warn(n)}}}function s(e,t){this.c=(new Date).getTime(),t=t||u;var r=i(t);this.e=r.getTime(),this.v=e}function c(n){var i={storage:"localStorage",serializer:l,exp:1/0},a=e(i,n),s=r(a.storage),c=t(s);this.isSupported=function(){return c},c?(this.storage=s,this.serializer=a.serializer,this.quotaExceedHandler=o):e(this,f)}var u=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),l={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return e&&JSON.parse(e)}},f={set:function(){},get:function(){},"delete":function(){},deleteAllExpires:function(){},clear:function(){},add:function(){},replace:function(){},touch:function(){}},h={set:function(t,r,n){if("string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),n=e({force:!0},n),void 0===r)return this["delete"](t);var i=this.serializer.serialize(r),o=new s(i,n.exp);try{this.storage.setItem(t,l.serialize(o))}catch(c){a(c)?this.quotaExceedHandler(t,i,n,c):console.error(c)}return r},get:function(e){var t=l.deserialize(this.storage.getItem(e));if(null!=t){var r=(new Date).getTime();if(r<t.e){var n=t.v;return this.serializer.deserialize(n)}this["delete"](e)}return null},"delete":function(e){return this.storage.removeItem(e),e},deleteAllExpires:function(){for(var e=this.storage.length,t=[],r=this,n=0;e>n;n++){var i=this.storage.key(n),a=null;try{a=l.deserialize(this.storage.getItem(i))}catch(o){}if(null!=a&&null!=a.e){var s=(new Date).getTime();s>=a.e&&t.push(i)}}return t.forEach(function(e){r["delete"](e)}),t},clear:function(){this.storage.clear()},add:function(e,t,r){null==this.storage.getItem(e)&&this.set(e,t,r)},replace:function(e,t,r){null!=this.storage.getItem(e)&&this.set(e,t,r)},touch:function(e,t){var r=this.get(e);if(null!=r){r.e=i(t);try{this.storage.setItem(e,l.serialize(r))}catch(n){if(a(n)){var o={exp:r.e};this.quotaExceedHandler(e,r.v,o,n)}else console.error(n)}}}};return c.prototype=h,c});
