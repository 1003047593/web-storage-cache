/*!
    web-storage-cache -- Added `expires` and `serializer` to the localStorage and sessionStorage
    Version 0.0.1
    https://github.com/WQTeam/web-storage-cache
    (c) 2013-2015 WQTeam, MIT license
*/
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.WebStorageCache=b()}(this,function(){"use strict";function a(a,b){for(var c in b)a[c]=b[c];return a}function b(a){var b=!1;if(a&&a.setItem){b=!0;var c="__"+Math.round(1e7*Math.random());try{a.setItem(c,c),a.removeItem(c)}catch(d){b=!1}}return b}function c(a){var b=typeof a;return"string"===b?window[a]:a}function d(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())}function e(a,b){if(b=b||new Date,"number"==typeof a?a=a===1/0?j:new Date(b.getTime()+1e3*a):"string"==typeof a&&(a=new Date(a)),a&&!d(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a}function f(a){var b=!1;if(a)if(a.code)switch(a.code){case 22:b=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===a.name&&(b=!0)}else-2147024882===a.number&&(b=!0);return b}function g(a,b,c,d){if(console.warn("Quota exceeded!"),c&&c.force===!0){var e=this.deleteAllExpires();console.warn("delete all expires CacheItem : ["+e+"] and try execute `set` method again!");try{c.force=!1,this.set(a,b,c)}catch(d){console.warn(d)}}}function h(a,b){this.c=(new Date).getTime(),b=b||j;var c=e(b);this.e=c.getTime(),this.v=a}function i(d){var e={storage:"localStorage",serializer:k,exp:1/0},f=a(e,d),h=c(f.storage),i=b(h);this.isSupported=function(){return i},i?(this.storage=h,this.serializer=f.serializer,this.quotaExceedHandler=g):a(this,l)}var j=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),k={serialize:function(a){return JSON.stringify(a)},deserialize:function(a){return a&&JSON.parse(a)}},l={set:function(){},get:function(){},"delete":function(){},deleteAllExpires:function(){},clear:function(){},add:function(){},replace:function(){},touch:function(){}},m={set:function(b,c,d){if("string"!=typeof b&&(console.warn(b+" used as a key, but it is not a string."),b=String(b)),d=a({force:!0},d),void 0===c)return this["delete"](b);var e=this.serializer.serialize(c),g=new h(e,d.exp);try{this.storage.setItem(b,k.serialize(g))}catch(i){f(i)?this.quotaExceedHandler(b,e,d,i):console.error(i)}return c},get:function(a){var b=k.deserialize(this.storage.getItem(a));if(null!=b){var c=(new Date).getTime();if(c<b.e){var d=b.v;return this.serializer.deserialize(d)}this["delete"](a)}return null},"delete":function(a){return this.storage.removeItem(a),a},deleteAllExpires:function(){for(var a=this.storage.length,b=[],c=this,d=0;a>d;d++){var e=this.storage.key(d),f=null;try{f=k.deserialize(this.storage.getItem(e))}catch(g){}if(null!=f&&null!=f.e){var h=(new Date).getTime();h>=f.e&&b.push(e)}}return b.forEach(function(a){c["delete"](a)}),b},clear:function(){this.storage.clear()},add:function(a,b,c){null==this.storage.getItem(a)&&this.set(a,b,c)},replace:function(a,b,c){null!=this.storage.getItem(a)&&this.set(a,b,c)},touch:function(a,b){var c=this.get(a);if(null!=c){c.e=e(b);try{this.storage.setItem(a,k.serialize(c))}catch(d){if(f(d)){var g={exp:c.e};this.quotaExceedHandler(a,c.v,g,d)}else console.error(d)}}}};return i.prototype=m,i});